---
title: "Dictionnaire des variables"
format:
  html:
    theme: cosmo
    toc: false
    code-fold: false
execute:
  echo: false
  eval: true
  execute-dir: project
---

::: {.box .note}
ℹ️ Utilisez la recherche globale ou les filtres sous les en-têtes.
:::

```{r}
# Chargement
if (!requireNamespace("readxl", quietly = TRUE)) {
  install.packages("readxl", repos = "https://cloud.r-project.org")
}
if (!requireNamespace("DT", quietly = TRUE)) {
  install.packages("DT", repos = "https://cloud.r-project.org")
}

if (!requireNamespace("arrow", quietly = TRUE)) {
  install.packages("arrow", repos = "https://cloud.r-project.org")
}

library(readxl)
library(DT)
library(arrow)


safe_read_parquet <- function(path, ...) {
  if (!file.exists(path)) {
    stop("⚠️ Fichier introuvable : ", path)
  }
  tryCatch(
    {
      # Essai standard (avec mmap par défaut)
      arrow::read_parquet(path, ...)
    },
    error = function(e) {
      message("↪ Erreur lors de la lecture avec mmap. Nouvelle tentative sans mmap...")
      arrow::read_parquet(path, mmap = FALSE, ...)
    }
  )
}
```


```{r}
dict <- safe_read_parquet(
  "Z:/0_Direction_des_Etudes/Base_eleve/data/dictionnaire.parquet",
  mmap = FALSE
)

# En-têtes lisibles
names(dict) <- c("Variable", "Label", "Format")

# Table interactive
DT::datatable(
  dict,
  rownames   = FALSE,
  filter     = "top",
  extensions = "Buttons",
  options = list(
    pageLength = 25,
    autoWidth  = TRUE,
    dom = "Bfrtip",
    buttons = list(
      list(extend = "copy",  text = "Copier"),
      list(extend = "csv",   text = "CSV"),
      list(extend = "excel", text = "Excel"),
      list(extend = "print", text = "Imprimer")
    ),
    columnDefs = list(
      list(width = "25%", targets = 0),
      list(width = "55%", targets = 1),
      list(width = "20%", targets = 2)
    )
  ),
  class = "stripe hover row-border"
)
```
