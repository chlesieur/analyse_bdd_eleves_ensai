---
title: "Dictionnaire des variables"
format:
  html:
    theme: cosmo
    toc: false
    code-fold: false
execute:
  echo: false
  eval: true
  execute-dir: project
---

::: {.box .note}
ℹ️ Utilisez la recherche globale ou les filtres sous les en-têtes.
:::

```{r setup, include=FALSE}
pkgs <- c("arrow", "DT")

for (pkg in pkgs) {
  if (!requireNamespace(pkg, quietly = TRUE)) {
    message("Installation du package manquant : ", pkg)
    tryCatch(
      {
        install.packages(pkg, repos = "https://cloud.r-project.org")
        library(pkg, character.only = TRUE)
      },
      error = function(e) {
        stop("Impossible d’installer le package : ", pkg, "\n", e$message, call. = FALSE)
      }
    )
  } else {
    library(pkg, character.only = TRUE)
  }
}

```


```{r}
# Résolution de chemin robuste (évite les faux positifs en CI)
dict <- arrow::read_parquet(here("dictionnaire","dictionnaire.parquet"))

# Renommage seulement si ≥ 3 colonnes
if (ncol(dict) >= 3) {
  names(dict)[1:3] <- c("Variable", "Label", "Format")
}

DT::datatable(
  dict,
  rownames   = FALSE,
  filter     = "top",
  extensions = "Buttons",
  options = list(
    pageLength = 25,
    autoWidth  = TRUE,
    dom = "Bfrtip",
    buttons = list(
      list(extend = "copy",  text = "Copier"),
      list(extend = "csv",   text = "CSV"),
      list(extend = "excel", text = "Excel"),
      list(extend = "print", text = "Imprimer")
    ),
    columnDefs = list(
      list(width = "25%", targets = 0),
      list(width = "55%", targets = 1),
      list(width = "20%", targets = 2)
    )
  ),
  class = "stripe hover row-border"
)
```
